<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒ­ã‚°ã‚¤ãƒ³</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body class="dark">
  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ -->
  <div class="navbar">
    <div class="brand">ğŸŒ</div>
    <button id="themeToggle">ğŸŒ™</button>
  </div>

  <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div class="auth-container">
    <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
    <form id="loginForm">
      <input type="text" name="identifier" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required>
      <input type="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
      <button type="submit">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>

    <div class="auth-links">
      <a href="register.html">æ–°è¦ç™»éŒ²</a> |
      <a href="forgot.html">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã§ã™ã‹ï¼Ÿ</a>
    </div>
  </div>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const identifier = e.target.identifier.value;
      const password = e.target.password.value;

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ identifier, password })
        });

        const result = await response.json();

        if (response.ok) {
        console.log("âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ", result); // â† ã“ã®è¡Œã‚’è¿½åŠ 
        localStorage.setItem('user_id', result.user.id);
        localStorage.setItem('username', result.user.username); // â† ã“ã‚ŒãŒ undefined ã®å¯èƒ½æ€§
        localStorage.setItem('avatar_url', result.user.avatar_url || '');
        window.location.href = '../home.html';
        }else {
          alert(result.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
      } catch (err) {
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚¨ãƒ©ãƒ¼:', err);
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚¨ãƒ©ãƒ¼:', err.name, err.message, err.stack);
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ã‚¨ãƒ©ãƒ¼:', JSON.stringify(err));

        alert('ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    });
  </script>


  <div id="navbar-placeholder"></div>
  <script src="../js/navbar.js"></script>
</body>
</html>
